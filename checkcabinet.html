<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Kiểm Tra Tủ Điện Hàng Quý</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --bg-color: #f4f4f9;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        /* --- Login Screen Styles --- */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-box {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            text-align: center;
            width: 300px;
        }

        .login-box input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background-color: #004494;
        }

        /* --- Main App Styles --- */
        #app-container {
            display: none; /* Hidden by default */
            background: white;
            width: 100%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h2 { margin: 0; font-size: 1.5rem; }
        .header p { margin: 5px 0 0; opacity: 0.8; font-size: 0.9rem; }

        .form-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* Table Styles for Checklist */
        .checklist-item {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 15px;
            padding: 15px;
            background-color: #fff;
        }

        .checklist-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .checklist-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            font-style: italic;
        }

        .options-group {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-label input { margin-right: 5px; }

        .note-input {
            width: 100%;
            padding: 8px;
            border: 1px dashed #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #fafafa;
        }

        .note-input:focus {
            background-color: #fff;
            border-color: var(--primary-color);
            outline: none;
        }

        .footer-btn {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            text-align: right;
        }

        /* Error Message */
        #login-error {
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .options-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h3>Bảo mật</h3>
            <p>Vui lòng nhập mật khẩu để tiếp tục</p>
            <input type="password" id="password-input" placeholder="Nhập mật khẩu (1234)">
            <button class="btn btn-primary" onclick="checkPassword()">Đăng nhập</button>
            <div id="login-error">Mật khẩu không đúng!</div>
        </div>
    </div>

    <div id="app-container">
        <div class="header">
            <h2>PHIẾU KIỂM TRA TỦ ĐIỆN HÀNG QUÝ</h2>
            <p>Mã tài liệu: TA-MNT-PC01-WI01-F01.02</p>
        </div>

        <form id="checklistForm" class="form-body" onsubmit="handleFormSubmit(event)">
            
            <div class="form-group">
                <label>Khu vực / Xưởng (Area / Factory):</label>
                <input type="text" name="area" class="form-control" required placeholder="Ví dụ: Xưởng 1">
            </div>

            <div class="form-group">
                <label>Ngày kiểm tra:</label>
                <input type="date" name="date" id="dateInput" class="form-control" required>
            </div>

            <div class="form-group">
                <label>Tên Kỹ thuật viên:</label>
                <input type="text" name="technician" class="form-control" required>
            </div>

            <hr>

            <h3>Nội dung kiểm tra (Checklist)</h3>

            <div class="checklist-item">
                <div class="checklist-title">1. Kiểm tra ngoại quan hư hỏng vật lý</div>
                <div class="checklist-desc">Kiểm ra tủ, cửa, bản lề, thiết bị đóng cắt, đồng hồ đo lường, dây cáp, các vị trí kết nối có bất kỳ hư hỏng vật lý nào không?</div>
                <div class="options-group">
                    <label class="radio-label"><input type="radio" name="item1" value="OK" required onchange="toggleNoteColor(this, 'note1')"> Đạt (OK)</label>
                    <label class="radio-label"><input type="radio" name="item1" value="NOK" onchange="toggleNoteColor(this, 'note1')"> Không Đạt (NOK)</label>
                </div>
                <input type="text" id="note1" name="note1" class="note-input" placeholder="Ghi chú (Bắt buộc nếu NOK)...">
            </div>

            <div class="checklist-item">
                <div class="checklist-title">2. Kiểm tra tình trạng bụi trong tủ điện</div>
                <div class="checklist-desc">Không có bụi bẩn, mạng nhện, vật lạ trong tủ, lưới quạt tản nhiệt?</div>
                <div class="options-group">
                    <label class="radio-label"><input type="radio" name="item2" value="OK" required onchange="toggleNoteColor(this, 'note2')"> Đạt (OK)</label>
                    <label class="radio-label"><input type="radio" name="item2" value="NOK" onchange="toggleNoteColor(this, 'note2')"> Không Đạt (NOK)</label>
                </div>
                <input type="text" id="note2" name="note2" class="note-input" placeholder="Ghi chú (Bắt buộc nếu NOK)...">
            </div>

            <div class="checklist-item">
                <div class="checklist-title">3. Kiểm tra hiển thị đồng hồ và đèn báo</div>
                <div class="checklist-desc">Đèn báo pha có sáng không? Các chỉ số V, I, Kwh trên đồng hồ hiển thị đúng không?</div>
                <div class="options-group">
                    <label class="radio-label"><input type="radio" name="item3" value="OK" required onchange="toggleNoteColor(this, 'note3')"> Đạt (OK)</label>
                    <label class="radio-label"><input type="radio" name="item3" value="NOK" onchange="toggleNoteColor(this, 'note3')"> Không Đạt (NOK)</label>
                </div>
                <input type="text" id="note3" name="note3" class="note-input" placeholder="Ghi chú (Bắt buộc nếu NOK)...">
            </div>

            <div class="checklist-item">
                <div class="checklist-title">4. Scan nhiệt thiết bị đóng cắt, đầu cáp</div>
                <div class="checklist-desc">Nhiệt độ môi trường < 50°C. Nhiệt độ điểm nối MCCB, MCB < 70°C?</div>
                <div class="options-group">
                    <label class="radio-label"><input type="radio" name="item4" value="OK" required onchange="toggleNoteColor(this, 'note4')"> Đạt (OK)</label>
                    <label class="radio-label"><input type="radio" name="item4" value="NOK" onchange="toggleNoteColor(this, 'note4')"> Không Đạt (NOK)</label>
                </div>
                <input type="text" id="note4" name="note4" class="note-input" placeholder="Ghi chú (Bắt buộc nếu NOK)...">
            </div>

            <div class="checklist-item">
                <div class="checklist-title">5. Đo điện trở cách điện</div>
                <div class="checklist-desc">Điện trở cách điện các pha-pha, pha-N, pha-PE > 2 MΩ?</div>
                <div class="options-group">
                    <label class="radio-label"><input type="radio" name="item5" value="OK" required onchange="toggleNoteColor(this, 'note5')"> Đạt (OK)</label>
                    <label class="radio-label"><input type="radio" name="item5" value="NOK" onchange="toggleNoteColor(this, 'note5')"> Không Đạt (NOK)</label>
                </div>
                <input type="text" id="note5" name="note5" class="note-input" placeholder="Ghi chú (Bắt buộc nếu NOK)...">
            </div>

            <div class="form-group">
                <label>Ghi chú chung / Vấn đề cần khắc phục:</label>
                <textarea name="general_remark" class="form-control" rows="3"></textarea>
            </div>

            <div class="footer-btn">
                <button type="submit" class="btn btn-primary" style="width: auto; padding: 12px 30px;">Hoàn thành & Gửi</button>
            </div>
        </form>
    </div>

    <script>
        // Cấu hình mật khẩu
        const APP_PASSWORD = "1234";

        // Tự động điền ngày hôm nay
        document.getElementById('dateInput').valueAsDate = new Date();

        // Hàm kiểm tra mật khẩu
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            const errorMsg = document.getElementById('login-error');
            
            if (input === APP_PASSWORD) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('app-container').style.display = 'block';
            } else {
                errorMsg.style.display = 'block';
                // Rung nhẹ ô input để báo sai (optional animation logic could go here)
            }
        }

        // Xử lý sự kiện nhấn Enter ở ô mật khẩu
        document.getElementById('password-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        // Hàm đổi màu ô ghi chú nếu chọn NOK
        function toggleNoteColor(radio, noteId) {
            const noteInput = document.getElementById(noteId);
            if (radio.value === 'NOK') {
                noteInput.style.backgroundColor = '#ffe6e6'; // Màu đỏ nhạt
                noteInput.style.borderColor = '#dc3545';
                noteInput.focus();
            } else {
                noteInput.style.backgroundColor = '#fafafa';
                noteInput.style.borderColor = '#ccc';
            }
        }

        // Xử lý khi nhấn Gửi
        function handleFormSubmit(event) {
            event.preventDefault(); // Ngăn load lại trang

            // Thu thập dữ liệu
            const formData = new FormData(event.target);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            // Kiểm tra logic đơn giản (Nếu NOK mà không ghi chú)
            let isValid = true;
            for (let i = 1; i <= 5; i++) {
                if (data[`item${i}`] === 'NOK' && (!data[`note${i}`] || data[`note${i}`].trim() === "")) {
                    alert(`Vui lòng nhập ghi chú cho Mục ${i} vì bạn đã chọn Không Đạt.`);
                    document.getElementById(`note${i}`).focus();
                    isValid = false;
                    break;
                }
            }

            if (isValid) {
                // Ở đây sau này sẽ tích hợp Firebase để lưu dữ liệu
                console.log("Dữ liệu đã thu thập:", data);
                alert("Đã thu thập dữ liệu thành công!\n(Xem Console để thấy dữ liệu chi tiết)");
                
                // Reset form (tuỳ chọn)
                // event.target.reset();
                // document.getElementById('dateInput').valueAsDate = new Date();
            }
        }
    </script>
</body>
</html>
