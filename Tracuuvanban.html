<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra c·ª©u VƒÉn b·∫£n Ph√°p lu·∫≠t & AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // C·∫•u h√¨nh Firebase c·ªßa b·∫°n
        const firebaseConfig = {
            apiKey: "AIzaSyCzWjfcD5Dgq7V-i2izb9tKLR6QM6qWPQo",
            authDomain: "tavietnam-78ae8.firebaseapp.com",
            projectId: "tavietnam-78ae8",
            storageBucket: "tavietnam-78ae8.firebasestorage.app",
            messagingSenderId: "670121705534",
            appId: "1:670121705534:web:1027ad98550573ad37116f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Bi·∫øn l∆∞u tr·ªØ vƒÉn b·∫£n ƒëang ch·ªçn ƒë·ªÉ h·ªèi AI
        let currentDocContext = "";

        // H√†m l·∫•y d·ªØ li·ªáu t·ª´ Firestore (Gi·∫£ l·∫≠p d·ªØ li·ªáu m·∫´u n·∫øu ch∆∞a c√≥ DB th·∫≠t)
        async function loadDocuments() {
            const listElement = document.getElementById('doc-list');
            listElement.innerHTML = '<p class="text-gray-500">ƒêang t·∫£i d·ªØ li·ªáu...</p>';
            
            // TODO: Khi b·∫°n ƒë√£ t·∫°o collection 'documents' trong Firestore, b·ªè comment d√≤ng d∆∞·ªõi
            // const querySnapshot = await getDocs(collection(db, "documents"));
            
            // D·ªØ li·ªáu m·∫´u m√¥ ph·ªèng (X√≥a ƒëi khi k·∫øt n·ªëi DB th·∫≠t)
            const mockDocs = [
                {
                    id: 1,
                    title: "Lu·∫≠t ƒê·∫•t ƒëai 2024",
                    downloadUrl: "https://drive.google.com/...", 
                    summary: "Quy ƒë·ªãnh v·ªÅ ch·∫ø ƒë·ªô s·ªü h·ªØu ƒë·∫•t ƒëai..."
                },
                {
                    id: 2,
                    title: "Ngh·ªã ƒë·ªãnh 13 v·ªÅ B·∫£o v·ªá d·ªØ li·ªáu c√° nh√¢n",
                    downloadUrl: "https://drive.google.com/...",
                    summary: "Quy ƒë·ªãnh v·ªÅ b·∫£o v·ªá d·ªØ li·ªáu c√° nh√¢n v√† tr√°ch nhi·ªám c·ªßa c√°c b√™n..."
                }
            ];

            listElement.innerHTML = '';
            
            // Render danh s√°ch (D√πng mockDocs ho·∫∑c querySnapshot)
            mockDocs.forEach((doc) => {
                const div = document.createElement('div');
                div.className = "bg-white p-4 rounded shadow mb-4 hover:shadow-md transition";
                div.innerHTML = `
                    <h3 class="font-bold text-lg text-blue-800">${doc.title}</h3>
                    <div class="mt-2 flex gap-2">
                        <a href="${doc.downloadUrl}" target="_blank" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">T·∫£i v·ªÅ</a>
                        <button onclick="selectDoc('${doc.title}', '${doc.summary}')" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">H·ªèi AI v·ªÅ vƒÉn b·∫£n n√†y</button>
                    </div>
                `;
                listElement.appendChild(div);
            });
        }

        // H√†m ch·ªçn vƒÉn b·∫£n ƒë·ªÉ ƒë∆∞a v√†o context cho AI
        window.selectDoc = (title, content) => {
            currentDocContext = content;
            document.getElementById('chat-context').innerText = `ƒêang h·ªèi v·ªÅ: ${title}`;
            document.getElementById('chat-section').classList.remove('hidden');
            window.scrollTo(0, document.body.scrollHeight);
        };

        // H√†m g·ªçi AI (C·∫ßn t√≠ch h·ª£p Gemini API Key)
        window.askAI = async () => {
            const question = document.getElementById('user-question').value;
            const chatBox = document.getElementById('chat-box');
            
            if (!question) return;

            // Hi·ªÉn th·ªã c√¢u h·ªèi
            chatBox.innerHTML += `<div class="text-right mb-2"><span class="bg-blue-100 p-2 rounded inline-block">${question}</span></div>`;
            
            // Hi·ªÉn th·ªã loading
            chatBox.innerHTML += `<div class="text-left mb-2 text-gray-500" id="loading">AI ƒëang suy nghƒ©...</div>`;

            // GI·∫¢ L·∫¨P TR·∫¢ L·ªúI (C·∫ßn thay th·∫ø b·∫±ng g·ªçi Gemini API th·ª±c t·∫ø)
            // Logic: G·ª≠i prompt = `D·ª±a v√†o vƒÉn b·∫£n sau: "${currentDocContext}", h√£y tr·∫£ l·ªùi c√¢u h·ªèi: "${question}"`
            
            setTimeout(() => {
                document.getElementById('loading').remove();
                const fakeAnswer = "ƒê√¢y l√† c√¢u tr·∫£ l·ªùi m√¥ ph·ªèng. ƒê·ªÉ ho·∫°t ƒë·ªông th·∫≠t, b·∫°n c·∫ßn ch√®n Gemini API Key v√†o code.";
                chatBox.innerHTML += `<div class="text-left mb-2"><span class="bg-gray-100 p-2 rounded inline-block">ü§ñ: ${fakeAnswer}</span></div>`;
                document.getElementById('user-question').value = '';
            }, 1000);
        };

        // Kh·ªüi ch·∫°y
        window.onload = loadDocuments;
    </script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <div class="container mx-auto p-6 max-w-4xl">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-blue-900">Kho VƒÉn B·∫£n Ph√°p Lu·∫≠t & AI Assistant</h1>
            <p class="text-gray-600 mt-2">L∆∞u tr·ªØ tr√™n Drive - Qu·∫£n l√Ω b·ªüi Firebase - H·ªèi ƒë√°p v·ªõi AI</p>
        </header>

        <section id="doc-list" class="space-y-4">
            </section>

        <section id="chat-section" class="mt-8 border-t pt-6 hidden">
            <div id="chat-context" class="font-semibold text-blue-700 mb-2"></div>
            
            <div id="chat-box" class="bg-white border rounded h-64 overflow-y-auto p-4 mb-4 shadow-inner">
                <div class="text-center text-gray-400 text-sm">B·∫Øt ƒë·∫ßu ƒë·∫∑t c√¢u h·ªèi v·ªÅ vƒÉn b·∫£n n√†y...</div>
            </div>

            <div class="flex gap-2">
                <input type="text" id="user-question" class="flex-1 border p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="V√≠ d·ª•: VƒÉn b·∫£n n√†y c√≥ hi·ªáu l·ª±c t·ª´ bao gi·ªù?">
                <button onclick="askAI()" class="bg-blue-800 text-white px-6 py-2 rounded hover:bg-blue-900">G·ª≠i</button>
            </div>
        </section>
    </div>

</body>
</html>
